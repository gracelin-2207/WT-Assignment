<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Life Expectancy Result</title>
  <style>
    body { font-family: Arial, sans-serif; background:#e1888899; padding:20px; }
    h1 { text-align:center; }
    .card {
      max-width:800px; margin:auto; background:#fff; padding:20px;
      border-radius:10px; box-shadow:0 4px 12px rgba(0,0,0,0.1);
    }
    img { max-width:120px; border-radius:10px; margin-top:10px; }
    .warning { color:rgb(146, 0, 0); font-weight:bold; margin-top:10px; }
    .back-btn {
      margin-top:20px; padding:10px 15px; border:none; cursor:pointer;
      background:#55626c; color:#fff; border-radius:6px;
      transition:background 0.3s;
    }
    .back-btn:hover { background:#29547e; }

    /* Timeline */
    .timeline-section { text-align: center; margin-top: 40px; }
    .timeline-bar-container {
      position: relative;
      width: 80%;
      max-width: 600px;
      height: 60px;
      margin: 0 auto 8px auto;
      background: none;
    }
    .timeline-bar {
      width: 100%;
      height: 25px;
      border-radius: 20px;
      overflow: hidden;
      display: flex;
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    }
    .segment { flex: 1; height: 100%; transition: background 0.4s;}
    .green { background: linear-gradient(to right, #4caf50 70%, #ffc107 100%);}
    .yellow { background: linear-gradient(to right, #ffc107 40%, #f44336 100%);}
    .red { background: #f44336; }

    #progress-doll {
      position: absolute;
      top: 2px;
      font-size: 32px;
      left: 0;
      transition: left 1.5s cubic-bezier(.86,0,.07,1);
      z-index: 2;
      filter: drop-shadow(0 2px 6px rgba(0,0,0,0.13));
      width: 32px;       /* Size constraint for calculations */
      height: 32px;
      text-align: center;
      line-height: 32px
    }
    .pit {
      position: absolute;
      right: -25px;
      top: -10px;
      font-size: 48px;
      z-index: 1;
      filter: opacity(0.55);
    }

    .scale {
      display: flex;
      justify-content: space-between;
      font-size: 14px;
      color: #555;
      width: 80%;
      max-width: 600px;
      margin-left: auto;
      margin-right: auto;
      margin-top: 0px;
    }
    /* Responsive */
    @media(max-width:600px){
      .timeline-bar-container, .scale { width: 98%; max-width: 98vw; }
    }
  </style>
</head>
<body>
  <h1>üîÆ Your Life Expectancy Report</h1>
  <div class="card">
    <div id="userInfo"></div>
    <div id="lifeStats"></div>

    <div class="timeline-section">
      <h2>Life Timeline</h2>
      <div class="timeline-bar-container">
        <div class="timeline-bar">
          <div class="segment green"></div>
          <div class="segment yellow"></div>
          <div class="segment red"></div>
        </div>
        <div id="progress-doll">üòÄ</div>
        <div class="pit">üï≥Ô∏è</div>
      </div>
      <div class="scale" id="scale"></div>
    </div>

    <button class="back-btn" onclick="goBack()">‚¨Ö Back to Input</button>
  </div>

<script>
function goBack(){
  if (document.referrer) {
    window.history.back();
  } else {
    window.location.href = "form.html"; // fallback if opened directly
  }
}

window.onload = function(){
  let data = JSON.parse(localStorage.getItem('userData'));
  if(!data){ document.body.innerHTML="No data found!"; return; }

  // Show user info
  document.getElementById('userInfo').innerHTML = `
    <p><b>Name:</b> ${data.name}</p>
    <p><b>Gender:</b> ${data.gender}</p>
    <p><b>Locality:</b> ${data.locality}</p>
    <p><b>Age:</b> ${data.age}</p>
    ${data.picture ? `<img src="${data.picture}" alt="User Picture">` : ""}
    <p><b>Foods:</b> ${data.foods.join(", ") || "None"}</p>
    <p><b>Lifestyle:</b> ${data.lifestyle}</p>
    <p><b>Medical:</b> ${data.medical}</p>
    <p><b>Diet:</b> ${data.diet}</p>
    <p><b>Stress:</b> ${data.stress}</p>
  `;

  // Base expectancy calculation
  let expectancy = 75;
  if(data.lifestyle==="Smoker") expectancy -= 10;
  if(data.lifestyle==="Alcohol") expectancy -= 5;
  if(data.lifestyle==="Regular Exercise") expectancy += 5;
  if(data.lifestyle==="Poor Sleep") expectancy -= 3;

  if(data.medical==="Diabetes") expectancy -= 5;
  if(data.medical==="Blood Pressure") expectancy -= 4;
  if(data.medical==="Heart Disease") expectancy -= 7;

  if(data.diet==="Vegetarian") expectancy += 3;
  if(data.diet==="Junk Food Lover") expectancy -= 5;

  if(data.stress==="Low") expectancy += 2;
  if(data.stress==="High") expectancy -= 4;

  let junkFoods=["pizza","burger","fries","biryani"];
  let healthyFoods=["salad","fruit","fish"];
  data.foods.forEach(f=>{
    if(junkFoods.includes(f.toLowerCase())) expectancy -= 1;
    if(healthyFoods.includes(f.toLowerCase())) expectancy += 1;
  });

  let age = parseInt(data.age);
  let remaining = expectancy - age;

  // Stats
  let statsHTML = "";
  if(remaining > 0){
    statsHTML = `
      <p><b>Estimated Death Age:</b> ${expectancy} years</p>
      <p><b>Years Remaining:</b> ${remaining} years</p>
    `;
  } else {
    statsHTML = `
      <p><b>Estimated Death Age:</b> ${expectancy} years</p>
      <p class="warning">‚ö†Ô∏è Based on inputs, this person may have already crossed the average lifespan.</p>
    `;
  }
  document.getElementById('lifeStats').innerHTML = statsHTML;

  // Timeline scale
  document.getElementById("scale").innerHTML = `
    <span>0</span><span>${Math.floor(expectancy/2)}</span><span>${expectancy}</span>
  `;

  // Timeline logic
  let bar = document.querySelector('.timeline-bar');
  // Divide bar into color based on expectancy
  let greenW = Math.round(bar.offsetWidth * 0.6); // first 60% green
  let yellowW = Math.round(bar.offsetWidth * 0.28); // next 28% yellow
  let redW = Math.round(bar.offsetWidth * 0.12); // last 12% red
  bar.children[0].style.width = greenW + "px";
  bar.children[1].style.width = yellowW + "px";
  bar.children[2].style.width = redW + "px";

  // Position doll on the bar with smooth animation
  let percent = Math.min(100, Math.max(0, (age/expectancy)*100));
  let barWidth = bar.offsetWidth;
  let doll = document.getElementById("progress-doll");
  let minX = 0, maxX = barWidth - 48; // 48 is doll's width; keeps emoji inside bar
  let posX = minX + (maxX-minX) * (percent/100);
  doll.style.left = `${posX}px`;

  // Change emoji expression based on position
  if (percent < 33){
    doll.innerHTML = "üòÑ";
  } else if (percent < 66){
    doll.innerHTML = "üòê";
  } else if (percent < 90){
    doll.innerHTML = "üòü";
  } else {
    doll.innerHTML = "üò±";
  }
};
</script>
</body>
</html>
